
# **JDBC (Java Database Connectivity)**

---

## **1. What is JDBC?**

**Definition**:
JDBC is a **Java API** that allows Java programs to connect to a database, send SQL queries, and get results.

Think of JDBC like a **translator**:

* Java program speaks Java.
* Database speaks SQL.
* JDBC translates between them.

---

## **2. Why do we need JDBC?**

Imagine you write a program in Java to store student details.
Without JDBC:

* You’d have to manually save everything in text files (slow, hard to manage).
* Or, write separate code for each database (Oracle, MySQL, etc.).

With JDBC:

* You write **one set of code**.
* Just change the **driver** to connect to different databases.

---

## **3. JDBC Architecture**

### **Layers in JDBC**

1. **Java Application** – Your Java program.
2. **JDBC API** – Set of classes & interfaces provided by Java (`java.sql`, `javax.sql`).
3. **Driver Manager** – Loads correct database driver.
4. **JDBC Driver** – Provided by database vendor (e.g., MySQL, Oracle).
5. **Database** – Where your data is stored.

**Diagram**

```
Java Program
     ↓
 JDBC API
     ↓
Driver Manager
     ↓
 JDBC Driver
     ↓
 Database
```

---

## **4. JDBC Components**

| Component             | What it does                                 |
| --------------------- | -------------------------------------------- |
| **DriverManager**     | Loads the database driver and connects to DB |
| **Connection**        | Represents a link between Java program & DB  |
| **Statement**         | Sends SQL commands to DB                     |
| **PreparedStatement** | Sends precompiled SQL (faster, safer)        |
| **CallableStatement** | Calls stored procedures in DB                |
| **ResultSet**         | Holds data returned from DB queries          |

---

## **5. Steps to Connect Java with Database (JDBC Steps)**

### **Step 1 – Load the Driver**

This tells Java which database we’re using.

```java
Class.forName("com.mysql.cj.jdbc.Driver");
```

### **Step 2 – Establish Connection**

We give:

* Database URL
* Username
* Password

```java
Connection con = DriverManager.getConnection(
    "jdbc:mysql://localhost:3306/testdb", "root", "password");
```

### **Step 3 – Create Statement**

```java
Statement stmt = con.createStatement();
```

### **Step 4 – Execute SQL Query**

```java
ResultSet rs = stmt.executeQuery("SELECT * FROM students");
```

### **Step 5 – Process Results**

```java
while (rs.next()) {
    System.out.println(rs.getInt("id") + " " + rs.getString("name"));
}
```

### **Step 6 – Close Connection**

```java
rs.close();
stmt.close();
con.close();
```

---

## **6. JDBC Driver Types**

| Type   | Name                    | How it works               | Example                        | Notes                        |
| ------ | ----------------------- | -------------------------- | ------------------------------ | ---------------------------- |
| Type 1 | JDBC-ODBC Bridge        | Uses ODBC driver           | `sun.jdbc.odbc.JdbcOdbcDriver` | Outdated                     |
| Type 2 | Native API Driver       | Uses DB's native libraries | Oracle OCI                     | Requires client installation |
| Type 3 | Network Protocol Driver | Uses middleware server     | IDS Server                     | Rare now                     |
| Type 4 | Thin Driver             | Pure Java, direct to DB    | MySQL Connector/J              | **Most common today**        |

---

## **7. Statement Types**

### **Statement**

* For fixed SQL queries.

```java
Statement stmt = con.createStatement();
stmt.executeQuery("SELECT * FROM students");
```

### **PreparedStatement**

* Precompiled query.
* Prevents **SQL Injection** (hacking technique).

```java
PreparedStatement ps = con.prepareStatement("INSERT INTO students VALUES (?, ?)");
ps.setInt(1, 1);
ps.setString(2, "John");
ps.executeUpdate();
```

### **CallableStatement**

* Executes stored procedures in DB.

```java
CallableStatement cs = con.prepareCall("{call getStudent(?)}");
cs.setInt(1, 101);
ResultSet rs = cs.executeQuery();
```

---

## **8. Working with ResultSet**

* Think of **ResultSet** like a table in memory.

| Method              | What it does          |
| ------------------- | --------------------- |
| `next()`            | Moves to next row     |
| `getInt(column)`    | Gets int value        |
| `getString(column)` | Gets String value     |
| `previous()`        | Moves to previous row |
| `absolute(row)`     | Goes to specific row  |

Example:

```java
while (rs.next()) {
    System.out.println(rs.getInt(1) + " " + rs.getString(2));
}
```

---

## **9. Transactions in JDBC**

A **transaction** is a group of SQL statements that should either **all succeed** or **all fail**.

Example: Money transfer

```java
con.setAutoCommit(false);
try {
    stmt.executeUpdate("UPDATE accounts SET balance = balance - 100 WHERE id = 1");
    stmt.executeUpdate("UPDATE accounts SET balance = balance + 100 WHERE id = 2");
    con.commit();
} catch(Exception e) {
    con.rollback(); // Undo all changes
}
```

---

## **10. Batch Processing**

* Execute many queries together for speed.

```java
Statement stmt = con.createStatement();
stmt.addBatch("INSERT INTO students VALUES (3, 'Alex')");
stmt.addBatch("INSERT INTO students VALUES (4, 'Emma')");
stmt.executeBatch();
```

---

## **11. Metadata in JDBC**

* **DatabaseMetaData** → Info about database.
* **ResultSetMetaData** → Info about table columns.

Example:

```java
DatabaseMetaData dbmd = con.getMetaData();
System.out.println(dbmd.getDatabaseProductName());

ResultSetMetaData rsmd = rs.getMetaData();
System.out.println(rsmd.getColumnCount());
```

---

## **12. Connection Pooling**

Instead of creating a new connection every time (slow), reuse connections.

Tools:

* Apache DBCP
* HikariCP
* C3P0

---

## **13. Advantages**

✅ Works with any database.
✅ Supports transactions.
✅ Safer with `PreparedStatement`.
✅ Portable and standardized.

---

## **14. Disadvantages**

❌ More code than ORM frameworks like Hibernate.
❌ Manual resource closing needed.

---

## **15. Real-Life Examples**

* Banking systems (money transfer)
* School management software
* Employee payroll systems
* Inventory control

---

## **16. Quick Summary Table**

| Feature            | Statement  | PreparedStatement | CallableStatement |
| ------------------ | ---------- | ----------------- | ----------------- |
| Parameters         | ❌          | ✅                 | ✅                 |
| SQL Injection Safe | ❌          | ✅                 | ✅                 |
| Precompiled        | ❌          | ✅                 | ✅                 |
| Use Case           | Static SQL | Dynamic SQL       | Stored procedures |


---

# **Complete JDBC Example Code**

```java
import java.sql.*;

public class JDBCExamples {
    // Database credentials
    static final String URL = "jdbc:mysql://localhost:3306/testdb";
    static final String USER = "root";
    static final String PASSWORD = "password";

    public static void main(String[] args) {
        try {
            // 1. Load JDBC Driver
            Class.forName("com.mysql.cj.jdbc.Driver");
            System.out.println("Driver loaded successfully!");

            // 2. Establish Connection
            Connection con = DriverManager.getConnection(URL, USER, PASSWORD);
            System.out.println("Connected to the database!");

            // 3. Statement Example (SELECT)
            Statement stmt = con.createStatement();
            ResultSet rs = stmt.executeQuery("SELECT * FROM students");
            System.out.println("\n--- Statement Example (SELECT) ---");
            while (rs.next()) {
                System.out.println(rs.getInt("id") + " " + rs.getString("name"));
            }

            // 4. PreparedStatement Example (INSERT)
            PreparedStatement psInsert = con.prepareStatement("INSERT INTO students VALUES (?, ?)");
            psInsert.setInt(1, 3);
            psInsert.setString(2, "David");
            psInsert.executeUpdate();
            System.out.println("\nRecord inserted using PreparedStatement!");

            // 5. PreparedStatement Example (UPDATE)
            PreparedStatement psUpdate = con.prepareStatement("UPDATE students SET name=? WHERE id=?");
            psUpdate.setString(1, "Michael");
            psUpdate.setInt(2, 3);
            psUpdate.executeUpdate();
            System.out.println("Record updated using PreparedStatement!");

            // 6. PreparedStatement Example (DELETE)
            PreparedStatement psDelete = con.prepareStatement("DELETE FROM students WHERE id=?");
            psDelete.setInt(1, 3);
            psDelete.executeUpdate();
            System.out.println("Record deleted using PreparedStatement!");

            // 7. CallableStatement Example (Stored Procedure)
            // Stored procedure example:
            // CREATE PROCEDURE getStudent(IN sid INT) BEGIN SELECT * FROM students WHERE id = sid; END;
            CallableStatement cs = con.prepareCall("{call getStudent(?)}");
            cs.setInt(1, 1);
            ResultSet rsProc = cs.executeQuery();
            System.out.println("\n--- CallableStatement Example (Stored Procedure) ---");
            while (rsProc.next()) {
                System.out.println(rsProc.getInt("id") + " " + rsProc.getString("name"));
            }

            // 8. Transaction Example
            con.setAutoCommit(false); // Start transaction
            try {
                Statement transStmt = con.createStatement();
                transStmt.executeUpdate("UPDATE accounts SET balance = balance - 100 WHERE id = 1");
                transStmt.executeUpdate("UPDATE accounts SET balance = balance + 100 WHERE id = 2");
                con.commit();
                System.out.println("\nTransaction committed successfully!");
            } catch (Exception e) {
                con.rollback();
                System.out.println("Transaction rolled back due to error: " + e.getMessage());
            }
            con.setAutoCommit(true);

            // 9. Batch Processing Example
            Statement batchStmt = con.createStatement();
            batchStmt.addBatch("INSERT INTO students VALUES (4, 'Alex')");
            batchStmt.addBatch("INSERT INTO students VALUES (5, 'Emma')");
            batchStmt.executeBatch();
            System.out.println("\nBatch processing executed successfully!");

            // 10. Metadata Example
            DatabaseMetaData dbmd = con.getMetaData();
            System.out.println("\n--- Database Metadata ---");
            System.out.println("Database Product: " + dbmd.getDatabaseProductName());
            System.out.println("Database Version: " + dbmd.getDatabaseProductVersion());

            ResultSetMetaData rsmd = rs.getMetaData();
            System.out.println("\n--- ResultSet Metadata ---");
            System.out.println("Total Columns: " + rsmd.getColumnCount());
            for (int i = 1; i <= rsmd.getColumnCount(); i++) {
                System.out.println("Column " + i + ": " + rsmd.getColumnName(i) +
                                   " (" + rsmd.getColumnTypeName(i) + ")");
            }

            // 11. Close resources
            rs.close();
            rsProc.close();
            stmt.close();
            psInsert.close();
            psUpdate.close();
            psDelete.close();
            cs.close();
            con.close();
            System.out.println("\nConnection closed!");

        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

---

## **How This Code is Organized**

1. **Connect to Database**
   `Class.forName()` → `DriverManager.getConnection()`
2. **Basic SELECT** → `Statement`
3. **INSERT, UPDATE, DELETE** → `PreparedStatement`
4. **Stored Procedure Call** → `CallableStatement`
5. **Transaction Example** (commit/rollback)
6. **Batch Processing** (multiple inserts)
7. **Metadata** (database & result set info)
8. **Close all resources**

---

## **Before Running the Code**

* **MySQL table creation**

```sql
CREATE DATABASE testdb;
USE testdb;

CREATE TABLE students (
    id INT PRIMARY KEY,
    name VARCHAR(50)
);

CREATE TABLE accounts (
    id INT PRIMARY KEY,
    balance DECIMAL(10,2)
);

INSERT INTO accounts VALUES (1, 1000), (2, 500);

DELIMITER $$
CREATE PROCEDURE getStudent(IN sid INT)
BEGIN
    SELECT * FROM students WHERE id = sid;
END$$
DELIMITER ;
```

* **Add MySQL JDBC Driver** (`mysql-connector-j.jar`) to your project’s classpath.

---

