# JDBC ‚Äî CallableStatement

---

## 1) What is CallableStatement?

**`CallableStatement`** is a subinterface of `PreparedStatement` (in `java.sql` package).
It is used to **execute stored procedures** and **functions** in the database.

üëâ Stored procedures are precompiled SQL code stored in the database, which improves **performance**, **reusability**, and **security**.

---

## 2) Declaration

```java
CallableStatement cstmt = conn.prepareCall("{call procedure_name(?, ?)}");
```

* `{call ...}` ‚Üí JDBC escape syntax for calling stored procedures
* `?` ‚Üí placeholders for **IN, OUT, INOUT** parameters

---

## 3) Methods of CallableStatement

| Method                                         | Description                       |
| ---------------------------------------------- | --------------------------------- |
| `setInt(int index, int value)`                 | Sets IN parameter (integer)       |
| `setString(int index, String value)`           | Sets IN parameter (string)        |
| `registerOutParameter(int index, int sqlType)` | Registers OUT parameter           |
| `getInt(int index)`                            | Retrieves OUT parameter (integer) |
| `getString(int index)`                         | Retrieves OUT parameter (string)  |
| `execute()`                                    | Executes the stored procedure     |

---

## 4) Example 1: Stored Procedure with IN Parameter

### SQL (in MySQL)

```sql
DELIMITER //
CREATE PROCEDURE addStudent(IN id INT, IN name VARCHAR(50))
BEGIN
    INSERT INTO students VALUES (id, name);
END //
DELIMITER ;
```

### Java

```java
import java.sql.*;

class CallableStatementExample1 {
    public static void main(String[] args) {
        try {
            // 1. Load Driver
            Class.forName("com.mysql.cj.jdbc.Driver");

            // 2. Connection
            Connection conn = DriverManager.getConnection(
                "jdbc:mysql://localhost:3306/testdb", "root", "password");

            // 3. Prepare CallableStatement
            CallableStatement cstmt = conn.prepareCall("{call addStudent(?, ?)}");

            // 4. Set IN parameters
            cstmt.setInt(1, 101);
            cstmt.setString(2, "Alice");

            // 5. Execute
            cstmt.execute();
            System.out.println("Student inserted successfully.");

            // 6. Close
            cstmt.close();
            conn.close();

        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

---

## 5) Example 2: Stored Procedure with OUT Parameter

### SQL (in MySQL)

```sql
DELIMITER //
CREATE PROCEDURE getStudentName(IN id INT, OUT name VARCHAR(50))
BEGIN
    SELECT s.name INTO name FROM students s WHERE s.id = id;
END //
DELIMITER ;
```

### Java

```java
import java.sql.*;

class CallableStatementExample2 {
    public static void main(String[] args) {
        try {
            Class.forName("com.mysql.cj.jdbc.Driver");
            Connection conn = DriverManager.getConnection(
                "jdbc:mysql://localhost:3306/testdb", "root", "password");

            CallableStatement cstmt = conn.prepareCall("{call getStudentName(?, ?)}");

            // Set IN parameter
            cstmt.setInt(1, 101);

            // Register OUT parameter
            cstmt.registerOutParameter(2, Types.VARCHAR);

            // Execute
            cstmt.execute();

            // Retrieve OUT parameter
            String studentName = cstmt.getString(2);
            System.out.println("Student Name: " + studentName);

            cstmt.close();
            conn.close();

        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

---

## 6) Diagram (Workflow)

```
Java Application
       |
   Connection
       |
 CallableStatement
   |         |
 Procedure   |
 Call        |
   |         v
 Parameters IN/OUT
       |
 Execute -> Database (Stored Procedure)
       |
   ResultSet / OUT Parameters
```

---

## 7) Advantages of CallableStatement

‚úî **Faster execution** ‚Üí Stored procedures are precompiled.
‚úî **Security** ‚Üí Hides SQL logic from Java code.
‚úî **Code reuse** ‚Üí Same stored procedure can be used by multiple applications.
‚úî **Supports IN, OUT, INOUT** parameters.

---

## 8) When to Use CallableStatement?

‚úÖ Use when:

* You need to **call stored procedures** from Java.
* You want **complex business logic** inside the database.
* You want to **reuse SQL logic** across applications.

‚ùå Avoid when:

* Queries are simple and don‚Äôt need stored procedures.

---

## 9) Comparison: Statement vs PreparedStatement vs CallableStatement

| Feature     | Statement              | PreparedStatement       | CallableStatement           |
| ----------- | ---------------------- | ----------------------- | --------------------------- |
| Purpose     | Static SQL             | Parameterized SQL       | Stored Procedures           |
| Performance | Slower                 | Faster (precompiled)    | Fastest (precompiled in DB) |
| Security    | Prone to SQL Injection | Safe from SQL Injection | Very safe                   |
| Parameters  | No                     | IN                      | IN, OUT, INOUT              |
| Use Case    | Simple queries         | Queries with input      | Complex DB logic, SP calls  |

---

## 10) Summary Table

| Aspect      | CallableStatement                                                    |
| ----------- | -------------------------------------------------------------------- |
| Package     | `java.sql`                                                           |
| Created by  | `Connection.prepareCall(sql)`                                        |
| Executes    | Stored Procedures                                                    |
| Placeholder | `?`                                                                  |
| Parameters  | IN, OUT, INOUT                                                       |
| Methods     | `setInt`, `setString`, `registerOutParameter`, `getXXX`, `execute()` |
| Best for    | Stored procedures and functions                                      |
| Advantage   | Fast, secure, reusable SQL logic                                     |

---
