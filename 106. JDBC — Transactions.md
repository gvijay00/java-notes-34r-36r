# JDBC ‚Äî Transactions

---

## 1) What is a Transaction?

A **transaction** in JDBC is a **unit of work** that consists of one or more SQL statements executed together.

üëâ Either **all statements succeed (commit)** or **none of them take effect (rollback)**.
This ensures **data integrity** and **consistency**.

**Example in real life:**

* In a banking system:

  * Withdraw ‚Çπ500 from Account A
  * Deposit ‚Çπ500 into Account B
  * ‚úÖ Both must succeed, ‚ùå or both must fail.

---

## 2) Default Behavior in JDBC

* By default, every SQL statement is executed in **auto-commit mode**.
* This means each statement is treated as a **separate transaction** and is **automatically committed** after execution.

---

## 3) Transaction Management in JDBC

To control transactions manually:

1. **Disable auto-commit**

   ```java
   conn.setAutoCommit(false);
   ```

2. **Execute SQL statements**

3. **Commit transaction (if success)**

   ```java
   conn.commit();
   ```

4. **Rollback transaction (if failure)**

   ```java
   conn.rollback();
   ```

---

## 4) Methods for Transactions

| Method                   | Description                                           |
| ------------------------ | ----------------------------------------------------- |
| `setAutoCommit(false)`   | Disables auto-commit                                  |
| `commit()`               | Commits all SQL statements since last commit/rollback |
| `rollback()`             | Undoes all SQL statements since last commit           |
| `setSavepoint()`         | Creates a checkpoint in the transaction               |
| `rollback(Savepoint sp)` | Rollback to a specific savepoint                      |
| `releaseSavepoint(sp)`   | Removes a savepoint                                   |

---

## 5) Example 1: Simple Transaction

### Banking Example (Transfer Money)

```java
import java.sql.*;

class TransactionExample {
    public static void main(String[] args) {
        try {
            Class.forName("com.mysql.cj.jdbc.Driver");
            Connection conn = DriverManager.getConnection(
                "jdbc:mysql://localhost:3306/testdb", "root", "password");

            conn.setAutoCommit(false); // 1. Disable auto-commit

            Statement stmt = conn.createStatement();

            // Deduct from Account A
            stmt.executeUpdate("UPDATE accounts SET balance = balance - 500 WHERE id = 1");

            // Add to Account B
            stmt.executeUpdate("UPDATE accounts SET balance = balance + 500 WHERE id = 2");

            conn.commit(); // 2. Commit transaction
            System.out.println("Transaction Successful!");

            stmt.close();
            conn.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

---

## 6) Example 2: Transaction with Rollback

```java
import java.sql.*;

class TransactionRollbackExample {
    public static void main(String[] args) {
        Connection conn = null;
        try {
            Class.forName("com.mysql.cj.jdbc.Driver");
            conn = DriverManager.getConnection(
                "jdbc:mysql://localhost:3306/testdb", "root", "password");

            conn.setAutoCommit(false); // disable auto-commit

            Statement stmt = conn.createStatement();

            stmt.executeUpdate("UPDATE accounts SET balance = balance - 500 WHERE id = 1");

            // Simulate error (e.g., invalid account id)
            stmt.executeUpdate("UPDATE accounts SET balance = balance + 500 WHERE id = 999");

            conn.commit();
            System.out.println("Transaction Successful!");
        } catch (Exception e) {
            System.out.println("Error occurred. Rolling back...");
            try {
                if (conn != null) conn.rollback();
            } catch (SQLException ex) {
                ex.printStackTrace();
            }
        }
    }
}
```

---

## 7) Example 3: Using Savepoint

```java
import java.sql.*;

class SavepointExample {
    public static void main(String[] args) {
        try {
            Class.forName("com.mysql.cj.jdbc.Driver");
            Connection conn = DriverManager.getConnection(
                "jdbc:mysql://localhost:3306/testdb", "root", "password");

            conn.setAutoCommit(false);

            Statement stmt = conn.createStatement();

            stmt.executeUpdate("INSERT INTO students VALUES (101, 'Alice')");
            Savepoint sp1 = conn.setSavepoint("Savepoint1");

            stmt.executeUpdate("INSERT INTO students VALUES (102, 'Bob')");
            Savepoint sp2 = conn.setSavepoint("Savepoint2");

            // Rollback to Savepoint1 ‚Üí Bob‚Äôs insert will be undone
            conn.rollback(sp1);

            conn.commit();
            System.out.println("Rolled back to Savepoint1");

            stmt.close();
            conn.close();

        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

---

## 8) Diagram (Workflow)

```
Java Application
       |
   Connection
       |
 setAutoCommit(false)
       |
   Multiple SQL Statements
       |
 Commit (‚úî Save changes)
 Rollback (‚ùå Undo changes)
```

---

## 9) Advantages of Transactions

‚úî **Atomicity** ‚Üí All-or-nothing execution
‚úî **Consistency** ‚Üí Keeps data valid
‚úî **Isolation** ‚Üí Multiple transactions don‚Äôt affect each other
‚úî **Durability** ‚Üí Once committed, data is permanent

(These are the **ACID properties** of transactions ‚úÖ)

---

## 10) Summary Table

| Aspect              | Transactions in JDBC                   |
| ------------------- | -------------------------------------- |
| Default Mode        | Auto-commit = true                     |
| Disable Auto-commit | `conn.setAutoCommit(false)`            |
| Commit              | `conn.commit()`                        |
| Rollback            | `conn.rollback()`                      |
| Savepoint           | `conn.setSavepoint()`                  |
| Advantage           | Ensures data integrity and consistency |
| Example Use         | Banking, E-commerce, Booking systems   |

---

‚ö° **Key Teaching Note:**
Always wrap critical operations like **money transfer, order placement, seat booking** inside **transactions** to prevent data corruption.


